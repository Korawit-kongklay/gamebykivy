#:kivy 2.0.0

<Character>:
    canvas:
        Rectangle:
            pos: self.pos
            size: self.size
            texture: self.texture

<Platform>:
    canvas:
        Rectangle:
            pos: self.pos
            size: self.size
            texture: self.texture

<Attack>:
    canvas:
        PushMatrix
        Rotate:
            angle: self.attack_rotation
            origin: self.center
        Color:
            rgba: 1, 1, 0, 1
        Rectangle:
            pos: self.pos
            size: self.size
        PopMatrix

<Game>:
    size: root.size
    canvas.before:
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'assets/gifs/darkforest.gif'
    # Player HP Bar (Green) at top-left
    BoxLayout:
        pos: 10, root.height - 30  # 10px from left, 30px from top
        size_hint: None, None
        size: 100, 20  # Fixed size for the HP bar container
        canvas.before:
            Color:
                rgba: 0.2, 0.2, 0.2, 1  # Gray background for full bar
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0, 1, 0, 1  # Green for health
            Rectangle:
                pos: self.pos
                size: (self.width * (root.player.health / root.player.max_health) if root.player else 0, self.height)
        Label:
            text: f'HP: {root.player.health if root.player else 0}/{root.player.max_health if root.player else 0}'
            font_size: 14
            color: 1, 1, 1, 1
            size: self.texture_size
            pos: self.parent.pos[0] + 5, self.parent.pos[1] + 2
    # Stage, Score, and Health Label (moved to top-right)
    Label:
        text: f'Stage: {root.stage_number} Score: {root.score:.1f}'
        font_size: 20
        top: root.top - 10
        right: root.right - 10
    # Restart Button
    Button:
        text: 'Restart'
        size_hint: 0.2, 0.1
        pos_hint: {'center_x': 0.5, 'center_y': 0.4}
        opacity: 0 if root.game_active else 1
        disabled: root.game_active
        on_press: root.restart()